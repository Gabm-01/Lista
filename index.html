<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aniversário do Gabriel</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Celebrar o aniversário do Gabriel</h1>
        
        <h2>Menu e ingredientes</h2>
        
        <div id="content-container">
            <!-- Content will be dynamically loaded here -->
            <div class="loading">
                <p>Carregando lista de compras...</p>
            </div>
        </div>
    </div>

    <script>
        // Function to fetch and parse the README.md file
        async function loadReadmeContent() {
            try {
                const response = await fetch('README.md');
                if (!response.ok) {
                    throw new Error('Failed to load README.md');
                }
                
                const markdownContent = await response.text();
                parseMarkdownContent(markdownContent);
            } catch (error) {
                console.error('Error loading README:', error);
                document.getElementById('content-container').innerHTML = 
                    `<div class="error">Erro ao carregar a lista. ${error.message}</div>`;
            }
        }

        // Parse markdown content and extract tables
        function parseMarkdownContent(markdownContent) {
            const contentContainer = document.getElementById('content-container');
            contentContainer.innerHTML = '';
            
            // Split content by section headers (## headers)
            const sections = markdownContent.split(/^## /m);
            
            // Process each section (skip the first one as it's before any ## header)
            for (let i = 1; i < sections.length; i++) {
                const section = sections[i].trim();
                const sectionLines = section.split('\n');
                const sectionTitle = sectionLines[0].trim();
                
                // Find the table in this section
                const tableStartIndex = sectionLines.findIndex(line => line.includes('|---'));
                
                if (tableStartIndex > 0) {
                    // Create section div
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'section';
                    
                    // Add section title
                    const titleElem = document.createElement('h3');
                    titleElem.textContent = sectionTitle;
                    sectionDiv.appendChild(titleElem);
                    
                    // Process table
                    const tableLines = [];
                    
                    // Get table header
                    const headerLine = sectionLines[tableStartIndex - 1];
                    tableLines.push(headerLine);
                    
                    // Get divider line
                    tableLines.push(sectionLines[tableStartIndex]);
                    
                    // Get table rows
                    let rowIndex = tableStartIndex + 1;
                    while (rowIndex < sectionLines.length && sectionLines[rowIndex].includes('|')) {
                        tableLines.push(sectionLines[rowIndex]);
                        rowIndex++;
                    }
                    
                    // Create HTML table
                    const table = createTableFromMarkdown(tableLines);
                    sectionDiv.appendChild(table);
                    
                    // Add to container
                    contentContainer.appendChild(sectionDiv);
                }
            }
            
            // Initialize checkboxes
            initializeCheckboxes();
        }

        // Create HTML table from markdown table lines
        function createTableFromMarkdown(tableLines) {
            const table = document.createElement('table');
            
            // Process header
            const headerCells = parseTableRow(tableLines[0]);
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            headerCells.forEach(cell => {
                const th = document.createElement('th');
                th.textContent = cell.trim();
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Process body
            const tbody = document.createElement('tbody');
            
            for (let i = 2; i < tableLines.length; i++) {
                const cells = parseTableRow(tableLines[i]);
                
                if (cells.length >= 3) {
                    const tr = document.createElement('tr');
                    
                    // Add item name
                    const tdName = document.createElement('td');
                    tdName.textContent = cells[0].trim();
                    tr.appendChild(tdName);
                    
                    // Add quantity
                    const tdQuantity = document.createElement('td');
                    tdQuantity.textContent = cells[1].trim();
                    tr.appendChild(tdQuantity);
                    
                    // Add checkbox
                    const tdCheckbox = document.createElement('td');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'checkbox';
                    checkbox.dataset.item = cells[0].trim();
                    
                    // Check if the item is checked in the markdown
                    const checkStatus = cells[2].trim();
                    if (checkStatus.includes('[x]')) {
                        checkbox.checked = true;
                    }
                    
                    tdCheckbox.appendChild(checkbox);
                    tr.appendChild(tdCheckbox);
                    
                    tbody.appendChild(tr);
                }
            }
            
            table.appendChild(tbody);
            return table;
        }

        // Parse markdown table row into cells
        function parseTableRow(rowLine) {
            return rowLine.split('|')
                .map(cell => cell.trim())
                .filter((cell, index, array) => index > 0 && index < array.length - 1);
        }

        // Initialize checkbox behavior
        function initializeCheckboxes() {
            document.querySelectorAll('.checkbox').forEach(checkbox => {
                const id = `checkbox-${checkbox.dataset.item.replace(/\s+/g, '-').toLowerCase()}`;
                checkbox.id = id;
                
                // Load saved state
                if (localStorage.getItem(id) === 'true') {
                    checkbox.checked = true;
                }
                
                // Save state on change
                checkbox.addEventListener('change', () => {
                    localStorage.setItem(id, checkbox.checked);
                });
            });
        }

        // Load content when page loads
        document.addEventListener('DOMContentLoaded', loadReadmeContent);
    </script>
</body>
</html> 